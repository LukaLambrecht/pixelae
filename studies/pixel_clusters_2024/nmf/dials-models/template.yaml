TemplateFormatVersion: "2025-03-31"
Description: NMF model for pixel cluster occupancy
Resources:
  PixelNMF:
    Type: InferenceService::MLServer::SKLearn
    Workspace: global
    Properties:
      Description: Spot anomalies in the pixel cluster occupancy (barrel layers)
      Name: pixel-barrel-nmf
      Image: registry.cern.ch/docker.io/seldonio/mlserver:1.5.0
      MetricKey: output_0
      BuiltinThreshold: true
      InputSignature:
        - Name: BPix1
          MonitoringElement: PixelPhase1/Phase1_MechanicalView/PXBarrel/clusters_per_SignedModuleCoord_per_SignedLadderCoord_PXLayer_1
          DataType: TYPE_INT32 # to do: find correct data type
          Dims:
            - -1
            - 26
            - 72
        - Name: BPix2
          MonitoringElement: PixelPhase1/Phase1_MechanicalView/PXBarrel/clusters_per_SignedModuleCoord_per_SignedLadderCoord_PXLayer_2
          DataType: TYPE_INT32 # to do: find correct data type
          Dims:
            - -1
            - 58
            - 72
        - Name: BPix3
          MonitoringElement: PixelPhase1/Phase1_MechanicalView/PXBarrel/clusters_per_SignedModuleCoord_per_SignedLadderCoord_PXLayer_3
          DataType: TYPE_INT32 # to do: find correct data type
          Dims:
            - -1
            - 90
            - 72
        - Name: BPix4
          MonitoringElement: PixelPhase1/Phase1_MechanicalView/PXBarrel/clusters_per_SignedModuleCoord_per_SignedLadderCoord_PXLayer_4
          DataType: TYPE_INT32 # to do: find correct data type
          Dims:
            - -1
            - 130
            - 72
      OutputSignature:
        - Name: output_0
          DataType: TYPE_BOOL
          Dims:
            - -1
      CodeUri: /data/pixelae/studies/pixel_clusters_2024/nmf/dials-models/mlserver-model/
      Handler: app.Handler
      ModelUri: /data/pixelae/studies/pixel_clusters_2024/nmf/dials-models/mlserver-model/pnmf_test.joblib
      Resources:
        Requests:
          cpu: "0.1m"
          memory: "250m"
        Limits:
          cpu: "1"
          memory: "2Gi"
