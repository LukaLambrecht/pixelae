TemplateFormatVersion: "2025-03-31"
Description: NMF model for pixel cluster occupancy
Resources:
  PixelNMF:
    Type: InferenceService::MLServer::SKLearn
    Workspace: global
    Properties:
      Description: Spot anomalies in the pixel cluster occupancy (barrel layers)
      Name: pixel-barrel-nmf
      Image: registry.cern.ch/docker.io/seldonio/mlserver:1.5.0
      # note: the FlaggingKey and MetricKey should correspond to one of the names in the ResponseOutput,
      #       defined in mlserver-model/app.py/postprocess!
      FlaggingKey: Flag
      MetricKey: Metric
      BuiltinThreshold: true
      InputSignature:
        - Name: BPix1
          MonitoringElement: PixelPhase1/Phase1_MechanicalView/PXBarrel/clusters_per_SignedModuleCoord_per_SignedLadderCoord_PXLayer_1
          DataType: TYPE_INT32
          Dims:
            - -1
            - 26
            - 72
        - Name: BPix2
          MonitoringElement: PixelPhase1/Phase1_MechanicalView/PXBarrel/clusters_per_SignedModuleCoord_per_SignedLadderCoord_PXLayer_2
          DataType: TYPE_INT32
          Dims:
            - -1
            - 58
            - 72
        - Name: BPix3
          MonitoringElement: PixelPhase1/Phase1_MechanicalView/PXBarrel/clusters_per_SignedModuleCoord_per_SignedLadderCoord_PXLayer_3
          DataType: TYPE_INT32
          Dims:
            - -1
            - 90
            - 72
        - Name: BPix4
          MonitoringElement: PixelPhase1/Phase1_MechanicalView/PXBarrel/clusters_per_SignedModuleCoord_per_SignedLadderCoord_PXLayer_4
          DataType: TYPE_INT32
          Dims:
            - -1
            - 130
            - 72
      OutputSignature:
        - Name: Flag
          DataType: TYPE_BOOL
          Dims:
            - -1
        - Name: Metric
          DataType: TYPE_FP32
          Dims:
            - -1
      CodeUri: mlserver-model/
      Handler: app.Handler
      ModelUri: mlserver-model/pixelnmf.joblib
      Resources:
        Requests:
          cpu: "0.1m"
          memory: "250m"
        Limits:
          cpu: "1"
          memory: "10Gi"
